Mean_Duration = "Duration (ms) - Mean (SD)",
Mean_Slope = "Slope - Mean (SD)",
Mean_TimeBtw = "Time Btw Calls (ms) - Mean (SD)"
) %>%
# Add footnotes for units
tab_footnote(
footnote = "Frequency in kilohertz (kHz).",
locations = cells_column_labels(columns = Mean_Freq)
) %>%
tab_footnote(
footnote = "Duration and Time Between Calls in milliseconds (ms).",
locations = cells_column_labels(columns = c(Mean_Duration, Mean_TimeBtw))
)
## | label: data-manipulation
## | message: false
## | warning: false
# -----------------------------------------------------------------------------
# Tidy Step 1: Check for Missing Values (NAs)
# -----------------------------------------------------------------------------
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
# -----------------------------------------------------------------------------
# Tidy Step 2: Check for Outliers/Distributions (Boxplots)
# -----------------------------------------------------------------------------
bat_data_long <- bat_data %>%
select(-Filename) %>%
pivot_longer(
cols = c(time_btw_calls, call_duration, char_frequency, char_slope),
names_to = "parameter",
values_to = "value"
)
ggplot(bat_data_long, aes(x = Species, y = value, fill = Species)) +
geom_boxplot() +
facet_wrap(~ parameter, scales = "free_y", ncol = 2) +
labs(
title = "Distribution of Echolocation Parameters by Bat Species",
x = "Bat Species",
y = "Parameter Value (Units)"
) +
theme(legend.position = "none")
#
# -----------------------------------------------------------------------------
# Manipulation: Summary Statistics Table (Final Working Code)
# -----------------------------------------------------------------------------
# Create the summary table
bat_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
# Calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
) %>%
ungroup() %>%
# *** NEW/CORRECTED STEP: Format the Mean (SD) columns using dplyr::unite() ***
# We convert numeric Mean and SD to character strings and combine them.
mutate(
Frequency = paste0(Mean_Freq, " (", SD_Freq, ")"),
Duration = paste0(Mean_Duration, " (", SD_Duration, ")"),
Slope = paste0(Mean_Slope, " (", SD_Slope, ")"),
TimeBtw = paste0(Mean_TimeBtw, " (", SD_TimeBtw, ")")
) %>%
# Select only the required columns for the final table
select(Species, N, Frequency, Duration, Slope, TimeBtw) %>%
# Pipe the pre-formatted data to the 'gt' package
gt() %>%
tab_header(
title = md("**Descriptive Statistics of Echolocation Calls by Species**"),
subtitle = "Mean and Standard Deviation (SD) in parentheses"
) %>%
# Relabel the columns
cols_label(
N = "Count",
Frequency = "Frequency (kHz)",
Duration = "Duration (ms)",
Slope = "Slope",
TimeBtw = "Time Btw Calls (ms)"
) %>%
# Add footnotes for units
tab_footnote(
footnote = "Frequency in kilohertz (kHz).",
locations = cells_column_labels(columns = Frequency)
) %>%
tab_footnote(
footnote = "Duration and Time Between Calls in milliseconds (ms).",
locations = cells_column_labels(columns = c(Duration, TimeBtw))
)
# Display the high-quality table
bat_summary_table
install.packages("xfun")
install.packages("xfun")
install.packages("xfun")
install.packages("xfun")
install.packages("xfun")
install.packages("xfun")
#Load Core Libraries
#tidyverse for data manipulation (dplyr) and visualization (ggplot2)
library(tidyverse)
#randomForest for classification
library(randomForest)
##For creating highquality, formatted tables
library(gt)
#Set a consistent theme for all ggplot visualizations
theme_set(theme_bw())
##Set a seed for reproducibility, for the model later
set.seed(42)
#============ Data Import===================
#import the raw bat call data from the CSV file.
bat_data_raw <- read_csv("Bat_Call_Data.csv")
#===========data cleaning and variable type definition============
bat_data <- bat_data_raw %>%
##rename columns to a more consistent format
rename(
time_btw_calls = Time_Btw_Calls,
call_duration = Duration,
char_frequency = Frequency,
char_slope = Slope
) %>%
#convert the species column (the target variable) to a factor
mutate(
Species = as_factor(Species)
)
#================ Inspect the Cleaned Data=================
#Use glimpse() to quickly check the structure and ensure variable types are correct
glimpse(bat_data)
## | label: data-manipulation
## | message: false
## | warning: false
# -----------------------------------------------------------------------------
# Tidy Step 1: Check for Missing Values (NAs)
# -----------------------------------------------------------------------------
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
# -----------------------------------------------------------------------------
# Tidy Step 2: Check for Outliers/Distributions (Boxplots)
# -----------------------------------------------------------------------------
bat_data_long <- bat_data %>%
select(-Filename) %>%
pivot_longer(
cols = c(time_btw_calls, call_duration, char_frequency, char_slope),
names_to = "parameter",
values_to = "value"
)
ggplot(bat_data_long, aes(x = Species, y = value, fill = Species)) +
geom_boxplot() +
facet_wrap(~ parameter, scales = "free_y", ncol = 2) +
labs(
title = "Distribution of Echolocation Parameters by Bat Species",
x = "Bat Species",
y = "Parameter Value (Units)"
) +
theme(legend.position = "none")
#
# -----------------------------------------------------------------------------
# Manipulation: Summary Statistics Table (Final Working Code)
# -----------------------------------------------------------------------------
# Create the summary table
bat_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
# Calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
) %>%
ungroup() %>%
# *** NEW/CORRECTED STEP: Format the Mean (SD) columns using dplyr::unite() ***
# We convert numeric Mean and SD to character strings and combine them.
mutate(
Frequency = paste0(Mean_Freq, " (", SD_Freq, ")"),
Duration = paste0(Mean_Duration, " (", SD_Duration, ")"),
Slope = paste0(Mean_Slope, " (", SD_Slope, ")"),
TimeBtw = paste0(Mean_TimeBtw, " (", SD_TimeBtw, ")")
) %>%
# Select only the required columns for the final table
select(Species, N, Frequency, Duration, Slope, TimeBtw) %>%
# Pipe the pre-formatted data to the 'gt' package
gt() %>%
tab_header(
title = md("**Descriptive Statistics of Echolocation Calls by Species**"),
subtitle = "Mean and Standard Deviation (SD) in parentheses"
) %>%
# Relabel the columns
cols_label(
N = "Count",
Frequency = "Frequency (kHz)",
Duration = "Duration (ms)",
Slope = "Slope",
TimeBtw = "Time Btw Calls (ms)"
) %>%
# Add footnotes for units
tab_footnote(
footnote = "Frequency in kilohertz (kHz).",
locations = cells_column_labels(columns = Frequency)
) %>%
tab_footnote(
footnote = "Duration and Time Between Calls in milliseconds (ms).",
locations = cells_column_labels(columns = c(Duration, TimeBtw))
)
# Display the high-quality table
bat_summary_table
# -----------------------------------------------------------------------------
# Tidy Step 1: Check for Missing Values (NAs)
# -----------------------------------------------------------------------------
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
# -----------------------------------------------------------------------------
# Tidy Step 2: Check for outliers/distributions (Boxplots)
# -----------------------------------------------------------------------------
bat_data_long <- bat_data %>%
select(-Filename) %>%
pivot_longer(
cols = c(time_btw_calls, call_duration, char_frequency, char_slope),
names_to = "parameter",
values_to = "value"
)
ggplot(bat_data_long, aes(x = Species, y = value, fill = Species)) +
geom_boxplot() +
facet_wrap(~ parameter, scales = "free_y", ncol = 2) +
labs(
title = "Distribution of Echolocation Parameters by Bat Species",
x = "Bat Species",
y = "Parameter Value (Units)"
) +
theme(legend.position = "none")
# -----------------------------------------------------------------------------
# Manipulation: Summary statistics Table
# -----------------------------------------------------------------------------
##create the summary table
bat_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
##calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
) %>%
ungroup() %>%
#convert mean and SD to character strings and combine them
mutate(
Frequency = paste0(Mean_Freq, " (", SD_Freq, ")"),
Duration = paste0(Mean_Duration, " (", SD_Duration, ")"),
Slope = paste0(Mean_Slope, " (", SD_Slope, ")"),
TimeBtw = paste0(Mean_TimeBtw, " (", SD_TimeBtw, ")")
) %>%
###select only the required columns for the final table
select(Species, N, Frequency, Duration, Slope, TimeBtw) %>%
#pipe the pre-formatted data to the 'gt' package
gt() %>%
tab_header(
title = md("**Descriptive Statistics of Echolocation Calls by Species**"),
subtitle = "Mean and Standard Deviation (SD) in parentheses"
) %>%
#relabel the columns
cols_label(
N = "Count",
Frequency = "Frequency (kHz)",
Duration = "Duration (ms)",
Slope = "Slope",
TimeBtw = "Time Btw Calls (ms)"
) %>%
#display the high-quality table
bat_summary_table
# -----------------------------------------------------------------------------
# Tidy Step 1: Check for Missing Values (NAs)
# -----------------------------------------------------------------------------
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
# -----------------------------------------------------------------------------
# Tidy Step 2: Check for outliers/distributions (Boxplots)
# -----------------------------------------------------------------------------
bat_data_long <- bat_data %>%
select(-Filename) %>%
pivot_longer(
cols = c(time_btw_calls, call_duration, char_frequency, char_slope),
names_to = "parameter",
values_to = "value"
)
ggplot(bat_data_long, aes(x = Species, y = value, fill = Species)) +
geom_boxplot() +
facet_wrap(~ parameter, scales = "free_y", ncol = 2) +
labs(
title = "Distribution of Echolocation Parameters by Bat Species",
x = "Bat Species",
y = "Parameter Value (Units)"
) +
theme(legend.position = "none")
# -----------------------------------------------------------------------------
# Manipulation: Summary statistics Table
# -----------------------------------------------------------------------------
##create the summary table
bat_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
##calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
) %>%
ungroup() %>%
#convert mean and SD to character strings and combine them
mutate(
Frequency = paste0(Mean_Freq, " (", SD_Freq, ")"),
Duration = paste0(Mean_Duration, " (", SD_Duration, ")"),
Slope = paste0(Mean_Slope, " (", SD_Slope, ")"),
TimeBtw = paste0(Mean_TimeBtw, " (", SD_TimeBtw, ")")
) %>%
###select only the required columns for the final table
select(Species, N, Frequency, Duration, Slope, TimeBtw) %>%
#pipe the pre-formatted data to the 'gt' package
gt() %>%
tab_header(
title = md("**Descriptive Statistics of Echolocation Calls by Species**"),
subtitle = "Mean and Standard Deviation (SD) in parentheses"
) %>%
#relabel the columns
cols_label(
N = "Count",
Frequency = "Frequency (kHz)",
Duration = "Duration (ms)",
Slope = "Slope",
TimeBtw = "Time Btw Calls (ms)"
)
# Display the high-quality table
bat_summary_table
ggplot(bat_data,
aes(x = char_frequency, y = call_duration, color = Species, shape = Species)) +
geom_point(alpha = 0.7, size = 3) +
labs(
title = "Plot 1: Call Frequency vs. Duration by Species",
x = "Characteristic Frequency (kHz)",
y = "Call Duration (ms)",
color = "Species",
shape = "Species"
) +
theme_minimal() +
scale_color_brewer(palette = "Set1")
ggplot(bat_data, aes(x = char_slope, fill = Species, color = Species)) +
geom_density(alpha = 0.4) +
labs(
title = "Plot 2: Density Distribution of Characteristic Slope by Species",
x = "Characteristic Slope",
y = "Density",
fill = "Species",
color = "Species"
) +
theme_bw()
ggplot(bat_data, aes(x = Species, y = time_btw_calls, fill = Species)) +
geom_boxplot() +
geom_jitter(width = 0.1, alpha = 0.6) +
labs(
title = "Plot 3: Time Between Calls by Species",
x = "Bat Species",
y = "Time Between Calls (ms)"
) +
theme_light() +
theme(legend.position = "none")
#Split the data into training (70%) and testing (30%) sets.
data_split <- initial_split(
bat_data %>% select(-Filename), ###Exclude the identifier column
prop = 0.70, # 70% for training
strata = Species #Crucial for balanced training in classification
)
#Load Core Libraries
#tidyverse for data manipulation (dplyr) and visualization (ggplot2)
library(tidyverse)
#randomForest for classification
library(tidymodels)
##For creating highquality, formatted tables
library(gt)
#Set a consistent theme for all ggplot visualizations
theme_set(theme_bw())
##Set a seed for reproducibility, for the model later
set.seed(42)
#Split the data into training (70%) and testing (30%) sets.
data_split <- initial_split(
bat_data %>% select(-Filename), ###Exclude the identifier column
prop = 0.70, # 70% for training
strata = Species #Crucial for balanced training in classification
)
#Extract the training and testing data sets
bat_train <- training(data_split)
bat_test <- testing(data_split)
# Check the distribution of species in the sets (optional check)
prop.table(table(bat_train$Species))
prop.table(table(bat_test$Species))
#define the Random Forest model specification using the parsnip package
rf_model_spec <- rand_forest(mode = "classification",
trees = 500) %>%
set_engine("ranger", importance = "impurity")#Importance needed for variable analysis
#train the random Forest model using the training data
rf_fit <- rf_model_spec %>%
fit(Species ~ char_frequency + call_duration + char_slope + time_btw_calls,
data = bat_train)
#define the Random Forest model specification using the parsnip package
rf_model_spec_base <- rand_forest(mode = "classification",
trees = 500) %>%
set_engine("randomForest")
# Train (Fit) the Random Forest model using the training data
rf_fit_base <- rf_model_spec_base %>%
fit(Species ~ char_frequency + call_duration + char_slope + time_btw_calls,
data = bat_train)
# Output a brief summary of the fit object (to confirm training was successful)
print(rf_fit_base)
#use the trained model to predict species on the unseen test data
bat_results <- bat_test %>%
##add the predicted species class (.pred_class)
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "class")) %>%
# Add the predicted class probabilities (.pred_*)
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "prob"))
# --- Evaluation Metrics ---
# 1. Confusion Matrix: Shows correct vs. incorrect classifications per species.
# This is a key output for classification problems.
conf_matrix <- conf_mat(bat_results, truth = Species, estimate = .pred_class)
cat("Confusion Matrix:\n")
print(conf_matrix)
# 2. Key Metrics: Calculate Accuracy and Kappa (a measure of agreement).
model_metrics <- metric_set(accuracy, kap)
metrics_table <- bat_results %>%
model_metrics(truth = Species, estimate = .pred_class) %>%
select(-.estimator) %>%
# Use gt to format the metrics nicely
gt() %>%
tab_header(title = "Random Forest Model Performance Metrics") %>%
fmt_number(columns = where(is.numeric), decimals = 3)
# Display the performance metrics table
metrics_table
ggplot(bat_data, aes(x = char_slope, fill = Species, color = Species)) +
geom_density(alpha = 0.4) +
labs(
title = "Plot 2: Density Distribution of Characteristic Slope by Species",
x = "Characteristic Slope",
y = "Density",
fill = "Species",
color = "Species"
) +
theme_bw()
ggplot(bat_data, aes(x = Species, y = time_btw_calls, fill = Species)) +
geom_boxplot() +
geom_jitter(width = 0.1, alpha = 0.6) + # Add points to show individual data records
labs(
title = "Plot 3: Time Between Calls by Species",
x = "Bat Species",
y = "Time Between Calls (ms)"
) +
theme_light() +
theme(legend.position = "none")
#Load Core Libraries
#tidyverse for data manipulation (dplyr) and visualization (ggplot2)
library(tidyverse)
#randomForest for classification
library(tidymodels)
##For creating highquality, formatted tables
library(gt)
#Set a consistent theme for all ggplot visualizations
theme_set(theme_bw())
##Set a seed for reproducibility, for the model later
set.seed(42)
#use the trained model to predict species on the unseen test data
bat_results <- bat_test %>%
##add the predicted species class (.pred_class)
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "class")) %>%
# Add the predicted class probabilities
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "prob"))
###=====================Evaluation Metrics========================
# 1. Confusion Matrix:Shows correct vs. incorrect classifications per specie
conf_matrix <- conf_mat(bat_results, truth = Species, estimate = .pred_class)
cat("Confusion Matrix:\n")
print(conf_matrix)
##2. Key Metrics: Calculate Accuracy and Kappa
model_metrics <- metric_set(accuracy, kap)
metrics_table <- bat_results %>%
model_metrics(truth = Species, estimate = .pred_class) %>%
select(-.estimator) %>%
###se gt to format the metrics nicely
gt() %>%
tab_header(title = "Random Forest Model Performance Metrics") %>%
fmt_number(columns = where(is.numeric), decimals = 3)
#ddisplay the performance metrics table
metrics_table
