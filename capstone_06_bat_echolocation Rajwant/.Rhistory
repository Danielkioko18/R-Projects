fit(Species ~ char_frequency + call_duration + char_slope + time_btw_calls,
data = bat_train)
# Output a brief summary of the fit object (to confirm training was successful)
print(rf_fit_base)
#use the trained model to predict species on the unseen test data
bat_results <- bat_test %>%
##add the predicted species class (.pred_class)
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "class")) %>%
# Add the predicted class probabilities (.pred_*)
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "prob"))
# --- Evaluation Metrics ---
# 1. Confusion Matrix: Shows correct vs. incorrect classifications per species.
# This is a key output for classification problems.
conf_matrix <- conf_mat(bat_results, truth = Species, estimate = .pred_class)
cat("Confusion Matrix:\n")
print(conf_matrix)
# 2. Key Metrics: Calculate Accuracy and Kappa (a measure of agreement).
model_metrics <- metric_set(accuracy, kap)
metrics_table <- bat_results %>%
model_metrics(truth = Species, estimate = .pred_class) %>%
select(-.estimator) %>%
# Use gt to format the metrics nicely
gt() %>%
tab_header(title = "Random Forest Model Performance Metrics") %>%
fmt_number(columns = where(is.numeric), decimals = 3)
# Display the performance metrics table
metrics_table
ggplot(bat_data, aes(x = char_slope, fill = Species, color = Species)) +
geom_density(alpha = 0.4) +
labs(
title = "Plot 2: Density Distribution of Characteristic Slope by Species",
x = "Characteristic Slope",
y = "Density",
fill = "Species",
color = "Species"
) +
theme_bw()
ggplot(bat_data, aes(x = Species, y = time_btw_calls, fill = Species)) +
geom_boxplot() +
geom_jitter(width = 0.1, alpha = 0.6) + # Add points to show individual data records
labs(
title = "Plot 3: Time Between Calls by Species",
x = "Bat Species",
y = "Time Between Calls (ms)"
) +
theme_light() +
theme(legend.position = "none")
#Load Core Libraries
#tidyverse for data manipulation (dplyr) and visualization (ggplot2)
library(tidyverse)
#randomForest for classification
library(tidymodels)
##For creating highquality, formatted tables
library(gt)
#Set a consistent theme for all ggplot visualizations
theme_set(theme_bw())
##Set a seed for reproducibility, for the model later
set.seed(42)
#use the trained model to predict species on the unseen test data
bat_results <- bat_test %>%
##add the predicted species class (.pred_class)
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "class")) %>%
# Add the predicted class probabilities
bind_cols(predict(rf_fit_base, new_data = bat_test, type = "prob"))
###=====================Evaluation Metrics========================
# 1. Confusion Matrix:Shows correct vs. incorrect classifications per specie
conf_matrix <- conf_mat(bat_results, truth = Species, estimate = .pred_class)
cat("Confusion Matrix:\n")
print(conf_matrix)
##2. Key Metrics: Calculate Accuracy and Kappa
model_metrics <- metric_set(accuracy, kap)
metrics_table <- bat_results %>%
model_metrics(truth = Species, estimate = .pred_class) %>%
select(-.estimator) %>%
###se gt to format the metrics nicely
gt() %>%
tab_header(title = "Random Forest Model Performance Metrics") %>%
fmt_number(columns = where(is.numeric), decimals = 3)
#ddisplay the performance metrics table
metrics_table
library(tidyverse)
library(tidymodels)
library(gt)
#Import raw data
species_data_raw <- read_csv("Bat_Call_Data.csv")
#cleaning and variable type definition
bat_data <- species_data_raw %>%
##rename columns
rename(
time_btw_calls = Time_Btw_Calls,
call_duration = Duration,
char_frequency = Frequency,
char_slope = Slope
) %>%
mutate(
Species = as_factor(Species) #to a factor
)
glimpse(bat_data)
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
##create the summary table
species_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
##calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
)
# Display the high-quality table
bat_summary_table
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
##create the summary table
sp_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
##calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
)
# Display the high-quality table
sp_summary_table
ggplot(bat_data,
aes(x = char_frequency, y = call_duration, color = Species, shape = Species)) +
geom_point(alpha = 0.7, size = 3) +
labs(
title = "Plot 1: Call Frequency vs. Duration by Species",
x = "Characteristic Frequency (kHz)",
y = "Call Duration (ms)",
color = "Species",
shape = "Species"
) +
theme_minimal()
# We check for any NA values across all columns.
cat("Count of Missing Values (NA) per column:\n")
bat_data %>%
summarise(across(everything(), ~ sum(is.na(.))))
##create the summary table
sp_summary_table <- bat_data %>%
group_by(Species) %>%
summarise(
N = n(),
##calculate and round Mean and SD for all parameters
Mean_Freq = round(mean(char_frequency, na.rm = TRUE), 2),
SD_Freq = round(sd(char_frequency, na.rm = TRUE), 2),
Mean_Duration = round(mean(call_duration, na.rm = TRUE), 2),
SD_Duration = round(sd(call_duration, na.rm = TRUE), 2),
Mean_Slope = round(mean(char_slope, na.rm = TRUE), 2),
SD_Slope = round(sd(char_slope, na.rm = TRUE), 2),
Mean_TimeBtw = round(mean(time_btw_calls, na.rm = TRUE), 2),
SD_TimeBtw = round(sd(time_btw_calls, na.rm = TRUE), 2)
)
# Display the high-quality table
sp_summary_table
ggplot(bat_data, aes(x = char_slope, fill = Species, color = Species)) +
geom_density(alpha = 0.4) +
labs(
title = "Plot 2: Density Distribution of Characteristic Slope by Species",
x = "Characteristic Slope",
y = "Density",
fill = "Species",
color = "Species"
) +
theme_minimal()
ggplot(bat_data, aes(x = Species, y = time_btw_calls, fill = Species)) +
geom_boxplot() +
geom_jitter(width = 0.1, alpha = 0.6) + # Add points to show individual data records
labs(
title = "Plot 3: Time Between Calls by Species",
x = "Bat Species",
y = "Time Between Calls (ms)"
) +
theme_light()
ggplot(bat_data, aes(x = Species, y = time_btw_calls, fill = Species)) +
geom_boxplot() +
labs(
title = "Plot 3: Time Between Calls by Species",
x = "Bat Species",
y = "Time Between Calls (ms)"
) +
theme_light()
#=============Plot 1: Call Frequency vs. Duration by Species================
ggplot(bat_data,
aes(x = char_frequency, y = call_duration, color = Species, shape = Species)) +
geom_point(alpha = 0.7, size = 3) +
labs(
title = "Call Frequency vs. Duration by Species",
x = "Characteristic Frequency (kHz)",
y = "Call Duration (ms)"
) +
theme_minimal()
#=============Plot 1: Call Frequency vs. Duration by Species================
ggplot(bat_data,
aes(x = char_frequency, y = call_duration, color = Species)) +
geom_point(alpha = 0.7, size = 3) +
labs(
title = "Call Frequency vs. Duration by Species",
x = "Characteristic Frequency (kHz)",
y = "Call Duration (ms)"
) +
theme_minimal()
#=============Plot 1: Call Frequency vs. Duration by Species================
ggplot(bat_data,
aes(x = char_frequency, y = call_duration, color = Species)) +
geom_point(alpha = 0.7, size = 3) +
labs(
title = "Call Frequency vs. Duration by Species",
x = "Frequency (kHz)",
y = "Call Duration (ms)"
) +
theme_minimal()
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
randomforest_model <- randomForest(
species ~ duration + frequency + time_btw_calls + slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library("randomForest")
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
randomforest_model <- randomForest(
species ~ duration + frequency + time_btw_calls + slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
randomforest_model <- randomForest(
species ~ duration + frequency + time_btw_calls + slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ duration + frequency + time_btw_calls + slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ duration + frequency + time_btw_calls + Slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ duration + frequency + time_btw_calls + char_slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + frequency + time_btw_calls + char_slope,
data = training_data,
ntree = 300,
mtry = 2
)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
training_data <- bat_data[train_index, ]
testing_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = training_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(randomforest_model, newdata = testing_data)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
train_data <- bat_data[train_index, ]
test_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = training_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(model, newdata = test_data)
#accuracy
rf_accuracy <- mean(randomforest_predictions == test_data$species)
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
train_data <- bat_data[train_index, ]
test_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = training_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(model, newdata = test_data)
#accuracy
rf_accuracy <- mean(predictions == test_data$species)
print(sprintf(rf_accuracy))
print(rf_accuracy)
rf_accuracy
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
train_data <- bat_data[train_index, ]
test_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = training_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(model, newdata = test_data)
#accuracy
rf_accuracy <- mean(predictions == test_data$species)
rf_accuracy
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
train_data <- bat_data[train_index, ]
test_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = train_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(model, newdata = test_data)
#accuracy
rf_accuracy <- mean(predictions == test_data$species)
rf_accuracy
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
train_data <- bat_data[train_index, ]
test_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = train_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(model, newdata = test_data)
#accuracy
rf_accuracy <- mean(predictions == test_data$Species)
rf_accuracy
##Import randomforest library
library(randomForest)
set.seed(123)
## 70% training data
train_index <- sample(
1:nrow(bat_data),
size = 0.7 * nrow(bat_data)
)
#split into training and testing
train_data <- bat_data[train_index, ]
test_data  <- bat_data[-train_index, ]
##fit the model to parameters
model <- randomForest(
Species ~ call_duration + char_frequency + time_btw_calls + char_slope,
data = train_data,
ntree = 300,
mtry = 2
)
#make predictions
predictions <- predict(model, newdata = test_data)
#accuracy
model_accuracy <- mean(predictions == test_data$Species)
model_accuracy
